# Learning Rust

### Closure

```rust
fn main() {
    let sum = |a, b| a + b;
    println!("{}", sum(1, 2));
    // println!("{}", sum(1., 2.));  // error[E0308]: arguments to this function are incorrect
}
```
[Run It!](https://play.rust-lang.org/?version=stable&mode=debug&edition=2021&gist=262e08a5cc09b5b81e3a4263eb757b28)


```c++
#include <iostream>

int main() {
    auto sum = [](auto a, auto b) { return a + b; };
    std::cout << sum(1, 2) << std::endl;
    std::cout << sum(1., 2.) << std::endl;
}
```
[Run it!](https://godbolt.org/z/T56o46rEM)

### RPIT & RPITIT & AFIT

RPIT stands for Return Position Impl Trait.

```rust
trait Walkable {
    fn walk(&self);
}

struct Duck;
impl Walkable for Duck {
    fn walk(&self) {
        println!("duck walk!");
    }
}

struct Dog;
impl Walkable for Dog {
    fn walk(&self) {
        println!("dog walk!");
    }
}

fn create_walkable(name: &str) -> impl Walkable {
    match name {
        "duck" => Duck,
        // "dog" => Dog,  // expected `Duck`, found `Dog`
        _ => panic!("invalid name!"),
    }
}

fn type_name<T>(_: &T) -> &str {
    std::any::type_name::<T>()
}

fn main() {
    let walkable = create_walkable("duck");
    println!("type name: {}", type_name(&walkable));
}
```
[Run it!](https://play.rust-lang.org/?version=stable&mode=debug&edition=2021&gist=0301982aaca7cd56ff66c106c30410db)

RPITIT stands for Return Position Impl Trait In Trait.

```rust
trait Walkable {
    fn walk(&self);
}

trait IntoWalkable {
    fn into_walkable(self) -> impl Walkable;
}

struct Duck;
impl Walkable for Duck {
    fn walk(&self) {
        println!("duck walk!");
    }
}

impl IntoWalkable for &str {
    fn into_walkable(self) -> impl Walkable {
        match self {
            "duck" => Duck,
            _ => panic!("invalid name!"),
        }
    }
}

fn type_name<T>(_: &T) -> &str {
    std::any::type_name::<T>()
}

fn main() {
    let walkable = "duck".into_walkable();
    println!("type name: {}", type_name(&walkable));
}
```

[Run it!](https://play.rust-lang.org/?version=nightly&mode=debug&edition=2021&gist=11c17fba39e4564ee55e2bb583cb2689)

An AFIT stands for Async Fn In Trait, so an AFITâ€™s return type would be an RPIT inside a trait, so an RPITIT.

```rust
trait Service {
    async fn request(&self, key: i32) -> Response;
}
// =>
trait Service {
    fn request(&self, key: i32) -> impl Future<Output=Response>;
}
```

### References

1. [RPITs, RPITITs and AFITs and their relationship](https://santiagopastorino.com/2022/10/20/what-rpits-rpitits-and-afits-and-their-relationship/)
