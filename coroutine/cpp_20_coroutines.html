<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="/dist/favicon.ico">
    <link rel="apple-touch-icon" href="/dist/favicon.png">
    <link rel="stylesheet" type="text/css" href="/dist/highlight.css">
    <link rel="stylesheet" type="text/css" href="/dist/katex.min.css">
    <link rel="stylesheet" type="text/css" href="/dist/gitalk.css">
    <link rel="stylesheet" type="text/css" href="/dist/main.css">
    <title>åˆæ¢ C++20 åç¨‹ | SF-Zhou's Blog</title>
  </head>
  <body>
    <div class="app">
      <div class="title">
        <h1> åˆæ¢ C++20 åç¨‹ </h1>
      </div>
      <div class="info">
        <div class="date"> 2020.07.25 </div>
        <a href="https://github.com/SF-Zhou">
          <div class="author"> SF-Zhou </div>
        </a>
      </div>
      <div class="markdown">
        <p>å»å¹´å­¦ä¹  <code>libco</code> æ—¶å†™è¿‡ä¸€ç¯‡åšæ–‡ï¼Œ<a href="/programming/cpp_magic_coroutine.html">è®²è¿°å¦‚ä½•ä½¿ç”¨æ±‡ç¼–å®ç°åç¨‹åˆ‡æ¢</a>ã€‚ä»Šå¹´å®˜æ–¹çš„åç¨‹å®ç°æ›´åŠ æˆç†Ÿï¼Œç¼–è¯‘å™¨åŸç”Ÿæ”¯æŒåŠ ä¸Šæ— æ ˆçš„è®¾è®¡éƒ½å¸å¼•ç€ç¬”è€…ï¼Œå³ä½¿å·¥ä½œä¸­æ²¡æ³•ç”¨ä¸Šä¹Ÿæƒ³ä¸€æ¢ç©¶ç«Ÿã€‚æœ€è¿‘ Mac ä¸Šå¯ä»¥ç›´æ¥é€šè¿‡ Homebrew å®‰è£… gcc 10.1 äº†ï¼Œå€Ÿæ­¤æœºä¼šæ¢ç´¢ä¸€ä¸‹ C++20 åç¨‹çš„ç©æ³•ã€‚</p>
<p>é¦–å…ˆå»ºè®®é˜…è¯»<a href="https://en.cppreference.com/w/cpp/language/coroutines">å‚è€ƒæ–‡çŒ® 1</a>ï¼Œå¯ä»¥æ­é…æœ¬æ–‡ä¸­çš„å‡ ä¸ªä¾‹å­åŒæ­¥å­¦ä¹ ã€‚é¦–å…ˆçœ‹è¿™ä¸ªä¾‹å­ğŸŒ°ï¼ˆ<a href="https://godbolt.org/z/aGEo3j">åœ¨çº¿æ‰§è¡Œ</a>ï¼‰ï¼š</p>
<pre class="language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;coroutine></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span>

<span class="token keyword">struct</span> <span class="token class-name">Awaiter</span> <span class="token punctuation">{</span>
  <span class="token keyword">bool</span> <span class="token function">await_ready</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"await ready or not"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">await_resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"await resumed"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">await_suspend</span><span class="token punctuation">(</span>std<span class="token operator">::</span>coroutine_handle<span class="token operator">&lt;</span><span class="token operator">></span> h<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"await suspended"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">Promise</span> <span class="token punctuation">{</span>
  <span class="token keyword">struct</span> <span class="token class-name">promise_type</span> <span class="token punctuation">{</span>
    <span class="token keyword">auto</span> <span class="token function">get_return_object</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
      std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"get return object"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">auto</span> <span class="token function">initial_suspend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
      std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"initial suspend, return never"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
      <span class="token keyword">return</span> std<span class="token operator">::</span>suspend_never<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">auto</span> <span class="token function">final_suspend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
      std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"final suspend, return never"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
      <span class="token keyword">return</span> std<span class="token operator">::</span>suspend_never<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">unhandled_exception</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"unhandle exception"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
      std<span class="token operator">::</span><span class="token function">terminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">return_void</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"return void"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Promise <span class="token function">CoroutineFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"before co_await"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
  <span class="token keyword">co_await</span> <span class="token function">Awaiter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"after co_await"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"main() start"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
  <span class="token function">CoroutineFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"main() exit"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*
main() start
get return object
initial suspend, return never
before co_await
await ready or not
await resumed
after co_await
return void
final suspend, return never
main() exit
*/</span>
</code></pre>
<p>å½“å‡½æ•°ä¸­ä½¿ç”¨ <code>co_await</code> / <code>co_yield</code> / <code>co_return</code> å…³é”®å­—æ—¶ï¼Œç¼–è¯‘å™¨ä¼šå°†è¯¥å‡½æ•°è¯†åˆ«ä¸ºåç¨‹ã€‚æ¯ä¸ªåç¨‹å‡½æ•°éƒ½éœ€è¦ä½¿ç”¨åç¨‹çŠ¶æ€ <code>coroutine state</code> æ¥å­˜å‚¨å†…éƒ¨æ•°æ®ï¼ŒåŒ…æ‹¬åç¨‹æ‰¿è¯º <code>promise</code>ã€ä¼ å…¥åç¨‹çš„å‚æ•°ã€å½“å‰æŒ‚èµ·ç‚¹çš„æŸç§è¡¨ç¤ºå½¢å¼ä»¥åŠå½“å‰æŒ‚èµ·ç‚¹èŒƒå›´å†…çš„å±€éƒ¨å˜é‡å’Œä¸´æ—¶å˜é‡ã€‚è¯¥çŠ¶æ€åˆ†é…åœ¨å †ä¸Šï¼Œç”±ç¼–è¯‘å™¨è´Ÿè´£ç®¡ç†ã€‚åç¨‹æ‰¿è¯º <code>promise</code> ç”±åç¨‹å†…éƒ¨æ§åˆ¶ï¼Œç”¨äºåç¨‹æäº¤ç»“æœæˆ–å¼‚å¸¸ï¼›åç¨‹å¥æŸ„ <code>coroutine handle</code> ç”±åç¨‹å¤–éƒ¨æ§åˆ¶ï¼Œç”¨äºæ¢å¤åç¨‹æ‰§è¡Œæˆ–é”€æ¯åç¨‹ï¼›äºŒè€…å¯ä»¥é€šè¿‡æ¥å£è·å–åˆ°å¯¹æ–¹ã€‚</p>
<p>å½“è°ƒç”¨åç¨‹å‡½æ•°æ—¶ï¼Œå…¶æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>ä½¿ç”¨ <code>operator new</code> ç”³è¯·ç©ºé—´å¹¶åˆå§‹åŒ–åç¨‹çŠ¶æ€ï¼›</li>
<li>å¤åˆ¶åç¨‹å‚æ•°åˆ°åˆ°åç¨‹çŠ¶æ€ä¸­ï¼›</li>
<li>æ„é€ åç¨‹æ‰¿è¯ºå¯¹è±¡ <code>promise</code>ï¼›</li>
<li>è°ƒç”¨ <code>promise.get_return_object()</code> å¹¶å°†å…¶ç»“æœå­˜å‚¨åœ¨å±€éƒ¨å˜é‡ä¸­ã€‚è¯¥ç»“æœå°†ä¼šåœ¨åç¨‹é¦–æ¬¡æŒ‚èµ·æ—¶è¿”å›ç»™è°ƒç”¨è€…ï¼›</li>
<li>è°ƒç”¨ <code>co_await promise.initial_suspend()</code>ï¼Œé¢„å®šä¹‰äº† <code>std::suspend_always</code> è¡¨ç¤ºå§‹ç»ˆæŒ‚èµ·ï¼Œ<code>std::suspend_never</code> è¡¨ç¤ºå§‹ç»ˆä¸æŒ‚èµ·ï¼›</li>
<li>è€Œåæ­£å¼å¼€å§‹æ‰§è¡Œåç¨‹å‡½æ•°å†…è¿‡ç¨‹ã€‚</li>
</ol>
<p>å½“åç¨‹å‡½æ•°æ‰§è¡Œåˆ° <code>co_return [expr]</code> è¯­å¥æ—¶ï¼š</p>
<ol>
<li>è‹¥ <code>expr</code> ä¸º <code>void</code> åˆ™æ‰§è¡Œ <code>promise.return_void()</code>ï¼Œå¦åˆ™æ‰§è¡Œ <code>promise.return_value(expr)</code>ï¼›</li>
<li>æŒ‰ç…§åˆ›å»ºé¡ºåºçš„å€’åºé”€æ¯å±€éƒ¨å˜é‡å’Œä¸´æ—¶å˜é‡ï¼›</li>
<li>æ‰§è¡Œ <code>co_await promise.final_suspend()</code>ã€‚</li>
</ol>
<p>å½“åç¨‹æ‰§è¡Œåˆ° <code>co_yield expr</code> è¯­å¥æ—¶ï¼š</p>
<ol>
<li>æ‰§è¡Œ <code>co_await promise.yield_value(expr)</code>ã€‚</li>
</ol>
<p>å½“åç¨‹æ‰§è¡Œåˆ° <code>co_await expr</code> è¯­å¥æ—¶ï¼š</p>
<ol>
<li>é€šè¿‡ <code>expr</code> è·å¾— <code>awaiter</code> å¯¹è±¡ï¼›</li>
<li>æ‰§è¡Œ <code>awaiter.await_ready()</code>ï¼Œè‹¥ä¸º <code>true</code> åˆ™ç›´æ¥è¿”å› <code>awaiter.await_resume()</code>ï¼›</li>
<li>å¦åˆ™å°†åç¨‹æŒ‚èµ·å¹¶ä¿å­˜çŠ¶æ€ï¼Œæ‰§è¡Œ <code>awaiter.await_suspend()</code>ï¼Œè‹¥å…¶è¿”å›å€¼ä¸º <code>void</code> æˆ–è€… <code>true</code> åˆ™æˆåŠŸæŒ‚èµ·ï¼Œå°†æ§åˆ¶æƒè¿”è¿˜ç»™è°ƒç”¨è€… / æ¢å¤è€…ï¼›</li>
<li>ç›´åˆ° <code>handle.resume()</code> æ‰§è¡Œåè¯¥åç¨‹æ‰ä¼šæ¢å¤æ‰§è¡Œï¼Œå°† <code>awaiter.await_resume()</code> ä½œä¸ºè¡¨è¾¾å¼çš„è¿”å›å€¼ã€‚</li>
</ol>
<p>å½“åç¨‹å› ä¸ºæŸä¸ªæœªæ•è·çš„å¼‚å¸¸å¯¼è‡´ç»ˆæ­¢æ—¶ï¼š</p>
<ol>
<li>æ•è·å¼‚å¸¸å¹¶è°ƒç”¨ <code>promise.unhandled_exception()</code>ï¼›</li>
<li>è°ƒç”¨ <code>co_await promise.final_suspend()</code>ã€‚</li>
</ol>
<p>å½“åç¨‹çŠ¶æ€é”€æ¯æ—¶ï¼ˆé€šè¿‡åç¨‹å¥æŸ„ä¸»åŠ¨é”€æ¯ / <code>co_return</code> è¿”å› / æœªæ•è·å¼‚å¸¸ï¼‰ï¼š</p>
<ol>
<li>ææ„ <code>promise</code> å¯¹è±¡ï¼›</li>
<li>ææ„ä¼ å…¥çš„å‚æ•°ï¼›</li>
<li>å›æ”¶åç¨‹çŠ¶æ€å†…å­˜ã€‚</li>
</ol>
<p>ç®€æ˜æ¥çœ‹ï¼Œä¸€ä¸ªåç¨‹å‡½æ•°ä¼šè¢«ç¼–è¯‘å™¨æ‰§è¡Œç±»ä¼¼ä¸‹æ–¹çš„å±•å¼€ï¼š</p>
<pre class="language-cpp"><code class="language-cpp"><span class="token comment">// åç¨‹å‡½æ•°</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> R<span class="token punctuation">,</span> <span class="token keyword">typename</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> Args<span class="token operator">></span>
R <span class="token function">Func</span><span class="token punctuation">(</span>Args<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">auto</span> ret <span class="token operator">=</span> <span class="token keyword">co_await</span> <span class="token function">Awaiter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">co_yield</span> ret<span class="token punctuation">;</span>
  <span class="token keyword">co_return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// ç¼–è¯‘å™¨å±•å¼€</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> R<span class="token punctuation">,</span> <span class="token keyword">typename</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> Args<span class="token operator">></span>
R <span class="token function">Func</span><span class="token punctuation">(</span>Args<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">using</span> promise_t <span class="token operator">=</span> <span class="token keyword">typename</span> coroutine_traits<span class="token operator">&lt;</span>R<span class="token punctuation">,</span> Args<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">></span><span class="token operator">::</span>promise_type<span class="token punctuation">;</span>

  promise_t promise<span class="token punctuation">;</span>  <span class="token comment">// å®é™…ä¸Šåˆ†é…åœ¨å †ä¸Šè€Œéæ ˆä¸Šï¼Œè¿™é‡Œä¸ºäº†æ–¹ä¾¿è¯´æ˜ç®€åŒ–äº†</span>
  <span class="token keyword">auto</span> __return__ <span class="token operator">=</span> promise<span class="token punctuation">.</span><span class="token function">get_return_object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">co_await</span> promise<span class="token punctuation">.</span><span class="token function">initial_suspend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// auto ret = co_await Awaiter();</span>
    <span class="token keyword">auto</span> <span class="token operator">&amp;&amp;</span>value <span class="token operator">=</span> <span class="token function">Awaiter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> <span class="token operator">&amp;&amp;</span>awaitable <span class="token operator">=</span> <span class="token function">get_awaitable</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> <span class="token keyword">static_cast</span><span class="token operator">&lt;</span><span class="token keyword">decltype</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token operator">></span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> <span class="token operator">&amp;&amp;</span>awaiter <span class="token operator">=</span> <span class="token function">get_awaiter</span><span class="token punctuation">(</span><span class="token keyword">static_cast</span><span class="token operator">&lt;</span><span class="token keyword">decltype</span><span class="token punctuation">(</span>awaitable<span class="token punctuation">)</span><span class="token operator">></span><span class="token punctuation">(</span>awaitable<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>awaiter<span class="token punctuation">.</span><span class="token function">await_ready</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">using</span> handle_t <span class="token operator">=</span> std<span class="token operator">::</span>coroutine_handle<span class="token operator">&lt;</span>Promise<span class="token operator">></span><span class="token punctuation">;</span>
      <span class="token keyword">using</span> await_suspend_result_t <span class="token operator">=</span>
          <span class="token keyword">decltype</span><span class="token punctuation">(</span>awaiter<span class="token punctuation">.</span><span class="token function">await_suspend</span><span class="token punctuation">(</span>handle_t<span class="token operator">::</span><span class="token function">from_promise</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// åç¨‹æŒ‚èµ·</span>
      <span class="token keyword">if</span> <span class="token keyword">constexpr</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>is_void_v<span class="token operator">&lt;</span>await_suspend_result_t<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        awaiter<span class="token punctuation">.</span><span class="token function">await_suspend</span><span class="token punctuation">(</span>handle_t<span class="token operator">::</span><span class="token function">from_promise</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> __return__<span class="token punctuation">;</span>  <span class="token comment">// è¿”è¿˜æ§åˆ¶æƒç»™è°ƒç”¨è€…/æ¢å¤è€…</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">static_assert</span><span class="token punctuation">(</span>std<span class="token operator">::</span>is_same_v<span class="token operator">&lt;</span>await_suspend_result_t<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">></span><span class="token punctuation">,</span>
                      <span class="token string">"await_suspend() must return 'void' or 'bool'."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>awaiter<span class="token punctuation">.</span><span class="token function">await_suspend</span><span class="token punctuation">(</span>handle_t<span class="token operator">::</span><span class="token function">from_promise</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> __return__<span class="token punctuation">;</span>  <span class="token comment">// è¿”è¿˜æ§åˆ¶æƒç»™è°ƒç”¨è€…/æ¢å¤è€…</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// åç¨‹æ¢å¤ç‚¹ï¼Œhandle.resume() ååœ¨æ­¤å¤„æ¢å¤</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">auto</span> ret <span class="token operator">=</span> awaiter<span class="token punctuation">.</span><span class="token function">await_resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è¿”å› resume çš„å€¼</span>

    <span class="token comment">// co_yield ret;</span>
    <span class="token keyword">co_await</span> promise<span class="token punctuation">.</span><span class="token function">yield_value</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// co_return;</span>
    promise<span class="token punctuation">.</span><span class="token function">return_void</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">goto</span> final_suspend<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    promise<span class="token punctuation">.</span><span class="token function">set_exception</span><span class="token punctuation">(</span>std<span class="token operator">::</span><span class="token function">current_exception</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

final_suspend<span class="token operator">:</span>
  <span class="token keyword">co_await</span> promise<span class="token punctuation">.</span><span class="token function">final_suspend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>ç¬¬ä¸€ä¸ªæ ·ä¾‹ä¸­ <code>await_ready()</code> å§‹ç»ˆè¿”å› <code>true</code>ï¼Œåç¨‹å¹¶ä¸ä¼šæŒ‚èµ·è€Œæ˜¯ç»§ç»­åŒæ­¥æ‰§è¡Œç›´åˆ°ç»“æŸã€‚çœ‹å¦ä¸€ä¸ªä¾‹å­ğŸŒ°ï¼ˆ<a href="https://godbolt.org/z/soG5P1">åœ¨çº¿æ‰§è¡Œ</a>ï¼‰ï¼š</p>
<pre class="language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;coroutine></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;thread></span></span>

std<span class="token operator">::</span>coroutine_handle<span class="token operator">&lt;</span><span class="token operator">></span> handle<span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">Awaiter</span> <span class="token punctuation">{</span>
  <span class="token keyword">bool</span> <span class="token function">await_ready</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"await ready or not"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">await_resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"await resumed"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">await_suspend</span><span class="token punctuation">(</span>std<span class="token operator">::</span>coroutine_handle<span class="token operator">&lt;</span><span class="token operator">></span> h<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"await suspended"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
    handle <span class="token operator">=</span> h<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">Promise</span> <span class="token punctuation">{</span>
  <span class="token keyword">struct</span> <span class="token class-name">promise_type</span> <span class="token punctuation">{</span>
    <span class="token keyword">auto</span> <span class="token function">get_return_object</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
      std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"get return object"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">auto</span> <span class="token function">initial_suspend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
      std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"initial suspend, return never"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
      <span class="token keyword">return</span> std<span class="token operator">::</span>suspend_never<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">auto</span> <span class="token function">final_suspend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
      std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"final suspend, return never"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
      <span class="token keyword">return</span> std<span class="token operator">::</span>suspend_never<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">unhandled_exception</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"unhandle exception"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
      std<span class="token operator">::</span><span class="token function">terminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">return_void</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"return void"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Promise <span class="token function">CoroutineFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"before co_await"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
  <span class="token keyword">co_await</span> <span class="token function">Awaiter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"after co_await"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"main() start"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
  <span class="token function">CoroutineFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  std<span class="token operator">::</span>this_thread<span class="token operator">::</span><span class="token function">sleep_for</span><span class="token punctuation">(</span>std<span class="token operator">::</span>chrono<span class="token operator">::</span><span class="token function">seconds</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"resume coroutine after one second"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
  handle<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"main() exit"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*
main() start
get return object
initial suspend, return never
before co_await
await ready or not
await suspended
resume coroutine after one second
await resumed
after co_await
return void
final suspend, return never
main() exit
*/</span>
</code></pre>
<p>è¿™é‡Œ <code>awaiter.await_ready()</code> è¿”å› <code>false</code>ï¼Œåç¨‹ä¼šè¢«æŒ‚èµ·ã€‚ä¹‹å <code>awaiter.await_suspend(handle)</code> è¢«æ‰§è¡Œï¼Œ<code>handle</code> ä¹Ÿå°±æ˜¯ä¸Šæ–‡æåˆ°çš„åç¨‹å¥æŸ„ã€‚è¯¥å‡½æ•°éœ€è¦å®Œæˆå¯¹å¥æŸ„çš„è°ƒåº¦ï¼Œä»¥ä¾¿ä¹‹åç”±æ‰§è¡Œå™¨å»æ¢å¤è¯¥åç¨‹æˆ–å°†å…¶é”€æ¯ã€‚è‹¥ <code>awaiter.await_suspend(handle)</code> çš„è¿”å›ç±»å‹ä¸º <code>void</code>ï¼Œ<code>co_await</code> ä¼šç«‹å³å°†æ‰§è¡Œæƒå½’è¿˜ç»™è°ƒç”¨è€…ã€‚ç›´åˆ° <code>handle.resume()</code> æ‰§è¡Œæ—¶ï¼Œåç¨‹æ‰ä¼šæ¢å¤æ‰§è¡Œï¼Œå¹¶ä¸”ä¼šè°ƒç”¨ <code>awaiter.await_resume()</code> å¹¶å°†å…¶è¿”å›å€¼ä½œä¸º <code>co_await awaiter</code> çš„è¿”å›å€¼ã€‚ä¸Šé¢çš„ä¾‹å­ä¸­å°†åç¨‹å¥æŸ„èµ‹å€¼ç»™äº†å…¨å±€å˜é‡ <code>handle</code>ï¼Œè€Œååç¨‹æŒ‚èµ·ï¼Œå›åˆ° <code>main</code> å‡½æ•°ï¼Œç¡çœ  1s åè°ƒç”¨ <code>handle.resume()</code> æ¢å¤ã€‚</p>
<p><code>awaiter.await_suspend(handle)</code> æ‰§è¡Œå‰åç¨‹å·²å®ŒæˆæŒ‚èµ·ï¼Œæ­¤æ—¶åç¨‹çŠ¶æ€ä¸­å·²ç»ä¿å­˜äº†æ¢å¤æ‰€éœ€è¦çš„å„ç§çŠ¶æ€ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥å°†åç¨‹å¥æŸ„ä¸¢åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ä¸­æ¢å¤æ‰§è¡Œï¼Œå†çœ‹ä¸€ä¸ªä¾‹å­ğŸŒ°ï¼ˆ<a href="https://godbolt.org/z/MMnT6E">åœ¨çº¿æ‰§è¡Œ</a>ï¼‰ï¼š</p>
<pre class="language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;coroutine></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;thread></span></span>

std<span class="token operator">::</span>jthread thread<span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">Awaiter</span> <span class="token punctuation">{</span>
  <span class="token function">Awaiter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Awaiter()"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token operator">~</span><span class="token function">Awaiter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~Awaiter()"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">bool</span> <span class="token function">await_ready</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"await ready or not"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">await_resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"await resumed"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">await_suspend</span><span class="token punctuation">(</span>std<span class="token operator">::</span>coroutine_handle<span class="token operator">&lt;</span><span class="token operator">></span> h<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"await suspended"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>

    thread <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">jthread</span><span class="token punctuation">(</span><span class="token punctuation">[</span>h<span class="token punctuation">]</span> <span class="token punctuation">{</span>
      std<span class="token operator">::</span>this_thread<span class="token operator">::</span><span class="token function">sleep_for</span><span class="token punctuation">(</span>std<span class="token operator">::</span>chrono<span class="token operator">::</span><span class="token function">seconds</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"resume coroutine in another thread"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
      h<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">Promise</span> <span class="token punctuation">{</span>
  <span class="token keyword">struct</span> <span class="token class-name">promise_type</span> <span class="token punctuation">{</span>
    <span class="token keyword">auto</span> <span class="token function">get_return_object</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
      std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"get return object"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">auto</span> <span class="token function">initial_suspend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
      std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"initial suspend, return never"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
      <span class="token keyword">return</span> std<span class="token operator">::</span>suspend_never<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">auto</span> <span class="token function">final_suspend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
      std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"final suspend, return never"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
      <span class="token keyword">return</span> std<span class="token operator">::</span>suspend_never<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">unhandled_exception</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"unhandle exception"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
      std<span class="token operator">::</span><span class="token function">terminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">return_void</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"return void"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Promise <span class="token function">CoroutineFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"before co_await"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
  <span class="token keyword">co_await</span> <span class="token function">Awaiter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"after co_await"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"main() start"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
  <span class="token function">CoroutineFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"main() exit"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*
main() start
get return object
initial suspend, return never
before co_await
Awaiter()
await ready or not
await suspended
main() exit
resume coroutine in another thread
await resumed
~Awaiter()
after co_await
return void
final suspend, return never
*/</span>
</code></pre>
<p>è¿™é‡Œåœ¨ <code>awaiter.await_suspend(handle)</code> ä¸­æ–°å»ºäº†ä¸€ä¸ª <code>std::jthread</code>ï¼Œè®¡åˆ’åœ¨çº¿ç¨‹ä¸­ç¡çœ  +1s åæ¢å¤åç¨‹ã€‚è€Œååç¨‹æŒ‚èµ·ï¼Œéšå <code>main</code> å‡½æ•°ç»“æŸï¼Œå…¨å±€å˜é‡ææ„ï¼Œç­‰å¾…çº¿ç¨‹ <code>join()</code> ã€‚äºæ˜¯ 1s åçº¿ç¨‹ç­‰å¾…ç»“æŸå¹¶æ¢å¤çº¿ç¨‹ã€‚æ³¨æ„ <code>awaiter</code> å¯¹è±¡åœ¨åç¨‹æ¢å¤åè‡ªåŠ¨ææ„äº†ã€‚</p>
<p>è¿™å‡ ä¸ªç®€å•çš„ä¾‹å­å°±å¯ä»¥æ¿€å‘å¤§é‡æƒ³è±¡åŠ›äº†ã€‚æ— æ ˆåç¨‹åŠ ä¸Šç¼–è¯‘å™¨åŠ æŒï¼Œä»¥å‰ç”¨é­”æ³•æ‰èƒ½å®Œæˆçš„äº‹æƒ…ç°åœ¨å¯ä»¥åœ¨å®˜æ–¹è®¤è¯ä¸‹è½»æ¾å®Œæˆã€‚å½“ç„¶ç›®å‰æ ‡å‡†ä¸­åªæä¾›äº†åç¨‹çš„åŸºç¡€èƒ½åŠ›ï¼Œå‰©ä¸‹è°ƒåº¦å™¨/æ‰§è¡Œå™¨ã€IO å¤šè·¯å¤ç”¨ç­‰éƒ½éœ€è¦ä½¿ç”¨è€…è‡ªè¡Œå®ç°ï¼ŒæœŸå¾…å¼€æºç¤¾åŒºå‡ºç°å®Œæ•´æ˜“ç”¨çš„å¼‚æ­¥æ¡†æ¶ï¼Œç›®å‰è§‚å¯Ÿåˆ° GitHub ä¸Šå·²ç»æœ‰ <a href="https://github.com/facebook/folly/tree/master/folly/experimental/coro">folly/coro</a> å’Œ <a href="https://github.com/owt5008137/libcopp">libcopp</a> åœ¨è¿›è¡Œç›¸å…³å·¥ä½œäº†ã€‚</p>
<h3 id="references"><a href="#references">References</a></h3>
<ol>
<li><a href="https://en.cppreference.com/w/cpp/language/coroutines">&quot;Coroutines (C++20)&quot;, <em>C++ Reference</em></a></li>
<li><a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2018/n4775.pdf">&quot;Working Draft, C++ Extensions for Coroutines&quot;, <em>Open Standards</em></a></li>
<li><a href="https://www.cnblogs.com/wpcockroach/p/7403460.html">&quot;C++ Coroutine ç®€æ˜æ•™ç¨‹&quot;, <em>wpcockroach</em></a></li>
<li><a href="https://lewissbaker.github.io/2017/11/17/understanding-operator-co-await">&quot;C++ Coroutines: Understanding operator <code>co_await</code>&quot;, <em>lewissbaker</em></a></li>
</ol>

      </div>
      <div id="gitalk-container">
      </div>
      <div class="footer">
        <div class="license">
          Except where otherwise noted, content on this site is licensed under a <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> license.
        </div>
        <div class="copyright">
          CopyrightÂ©2020 SF-Zhou, All Rights Reserved. Powered by <a href="https://pages.github.com/">GitHub Pages</a> and <a href="https://github.com/features/actions">GitHub Actions</a>.
        </div>
      </div>
    </div>
    <script src="/dist/gitalk.min.js"></script>
    <script src="/dist/main.js"></script>
  </body>
</html>
