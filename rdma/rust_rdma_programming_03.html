<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="/dist/favicon.ico">
    <link rel="apple-touch-icon" href="/dist/favicon.png">
    <link rel="stylesheet" type="text/css" href="/dist/highlight.css">
    <link rel="stylesheet" type="text/css" href="/dist/katex.min.css">
    <link rel="stylesheet" type="text/css" href="/dist/main.css">
    <title>Rust RDMA 编程「三、对象封装」 | SF-Zhou's Blog</title>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GQ26H3JQ3G"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-GQ26H3JQ3G');
    </script>
  </head>
  <body>
    <div class="app">
      <div class="title">
        <h1> Rust RDMA 编程「三、对象封装」 </h1>
      </div>
      <div class="info">
        <div class="date"> 2024.07.30 </div>
        <a href="https://github.com/SF-Zhou">
          <div class="author"> SF-Zhou </div>
        </a>
      </div>
      <div class="markdown">
        <h3 id="1.-精简绑定" tabindex="-1"><a href="#1.-%E7%B2%BE%E7%AE%80%E7%BB%91%E5%AE%9A">1. 精简绑定</a></h3>
<p>系列的<a href="/rdma/rust_rdma_programming_02.html">上一篇</a>中讲述了如何对 <code>libibverbs</code> 库进行绑定。后续开发过程中笔者意识到真正需要的 API 接口其实是有限的，所以我决定精简接口绑定的代码，<code>build.rs</code> 如下：</p>
<pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span></span><span class="token class-name">HashSet</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>env<span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>path<span class="token punctuation">::</span></span><span class="token class-name">PathBuf</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> lib <span class="token operator">=</span> <span class="token namespace">pkg_config<span class="token punctuation">::</span></span><span class="token class-name">Config</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">statik</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">probe</span><span class="token punctuation">(</span><span class="token string">"libibverbs"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">unwrap_or_else</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>_<span class="token closure-punctuation punctuation">|</span></span> <span class="token macro property">panic!</span><span class="token punctuation">(</span><span class="token string">"please install libibverbs-dev and pkg-config"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> <span class="token keyword">mut</span> include_paths <span class="token operator">=</span> lib<span class="token punctuation">.</span>include_paths<span class="token punctuation">.</span><span class="token function">into_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">HashSet</span><span class="token operator">&lt;</span>_<span class="token operator">>></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    include_paths<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">PathBuf</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"/usr/include"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> builder <span class="token operator">=</span> <span class="token namespace">bindgen<span class="token punctuation">::</span></span><span class="token class-name">Builder</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">clang_args</span><span class="token punctuation">(</span>include_paths<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>p<span class="token closure-punctuation punctuation">|</span></span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"-I{:?}"</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">header_contents</span><span class="token punctuation">(</span><span class="token string">"header.h"</span><span class="token punctuation">,</span> <span class="token string">"#include &lt;infiniband/verbs.h>"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">derive_copy</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">derive_debug</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">derive_default</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">generate_comments</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">prepend_enum_name</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">formatter</span><span class="token punctuation">(</span><span class="token namespace">bindgen<span class="token punctuation">::</span></span><span class="token class-name">Formatter</span><span class="token punctuation">::</span><span class="token class-name">Rustfmt</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">size_t_is_usize</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">translate_enum_integer_types</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">layout_tests</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">default_enum_style</span><span class="token punctuation">(</span><span class="token namespace">bindgen<span class="token punctuation">::</span></span><span class="token class-name">EnumVariation</span><span class="token punctuation">::</span><span class="token class-name">Rust</span> <span class="token punctuation">{</span>
            non_exhaustive<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">opaque_type</span><span class="token punctuation">(</span><span class="token string">"pthread_cond_t"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">opaque_type</span><span class="token punctuation">(</span><span class="token string">"pthread_mutex_t"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_type</span><span class="token punctuation">(</span><span class="token string">"ibv_access_flags"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_type</span><span class="token punctuation">(</span><span class="token string">"ibv_comp_channel"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_type</span><span class="token punctuation">(</span><span class="token string">"ibv_context"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_type</span><span class="token punctuation">(</span><span class="token string">"ibv_cq"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_type</span><span class="token punctuation">(</span><span class="token string">"ibv_device"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_type</span><span class="token punctuation">(</span><span class="token string">"ibv_gid"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_type</span><span class="token punctuation">(</span><span class="token string">"ibv_mr"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_type</span><span class="token punctuation">(</span><span class="token string">"ibv_pd"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_type</span><span class="token punctuation">(</span><span class="token string">"ibv_port_attr"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_type</span><span class="token punctuation">(</span><span class="token string">"ibv_qp"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_type</span><span class="token punctuation">(</span><span class="token string">"ibv_qp_attr_mask"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_type</span><span class="token punctuation">(</span><span class="token string">"ibv_qp_init_attr"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_type</span><span class="token punctuation">(</span><span class="token string">"ibv_send_flags"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_type</span><span class="token punctuation">(</span><span class="token string">"ibv_wc"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_type</span><span class="token punctuation">(</span><span class="token string">"ibv_wc_flags"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_type</span><span class="token punctuation">(</span><span class="token string">"ibv_wc_status"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_function</span><span class="token punctuation">(</span><span class="token string">"ibv_ack_cq_events"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_function</span><span class="token punctuation">(</span><span class="token string">"ibv_alloc_pd"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_function</span><span class="token punctuation">(</span><span class="token string">"ibv_close_device"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_function</span><span class="token punctuation">(</span><span class="token string">"ibv_create_comp_channel"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_function</span><span class="token punctuation">(</span><span class="token string">"ibv_create_cq"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_function</span><span class="token punctuation">(</span><span class="token string">"ibv_create_qp"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_function</span><span class="token punctuation">(</span><span class="token string">"ibv_dealloc_pd"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_function</span><span class="token punctuation">(</span><span class="token string">"ibv_dereg_mr"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_function</span><span class="token punctuation">(</span><span class="token string">"ibv_destroy_comp_channel"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_function</span><span class="token punctuation">(</span><span class="token string">"ibv_destroy_cq"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_function</span><span class="token punctuation">(</span><span class="token string">"ibv_destroy_qp"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_function</span><span class="token punctuation">(</span><span class="token string">"ibv_free_device_list"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_function</span><span class="token punctuation">(</span><span class="token string">"ibv_get_cq_event"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_function</span><span class="token punctuation">(</span><span class="token string">"ibv_get_device_guid"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_function</span><span class="token punctuation">(</span><span class="token string">"ibv_get_device_list"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_function</span><span class="token punctuation">(</span><span class="token string">"ibv_modify_qp"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_function</span><span class="token punctuation">(</span><span class="token string">"ibv_req_notify_cq"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_function</span><span class="token punctuation">(</span><span class="token string">"ibv_poll_cq"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_function</span><span class="token punctuation">(</span><span class="token string">"ibv_post_recv"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_function</span><span class="token punctuation">(</span><span class="token string">"ibv_post_send"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_function</span><span class="token punctuation">(</span><span class="token string">"ibv_query_gid"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_function</span><span class="token punctuation">(</span><span class="token string">"ibv_query_port"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_function</span><span class="token punctuation">(</span><span class="token string">"ibv_open_device"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowlist_function</span><span class="token punctuation">(</span><span class="token string">"ibv_reg_mr"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">bitfield_enum</span><span class="token punctuation">(</span><span class="token string">"ibv_access_flags"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">bitfield_enum</span><span class="token punctuation">(</span><span class="token string">"ibv_send_flags"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">bitfield_enum</span><span class="token punctuation">(</span><span class="token string">"ibv_wc_flags"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">bitfield_enum</span><span class="token punctuation">(</span><span class="token string">"ibv_qp_attr_mask"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">no_copy</span><span class="token punctuation">(</span><span class="token string">"ibv_qp"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">no_copy</span><span class="token punctuation">(</span><span class="token string">"ibv_cq"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">no_copy</span><span class="token punctuation">(</span><span class="token string">"ibv_context"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    builder
        <span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"Unable to generate bindings"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">write_to_file</span><span class="token punctuation">(</span><span class="token class-name">PathBuf</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token namespace">env<span class="token punctuation">::</span></span><span class="token function">var</span><span class="token punctuation">(</span><span class="token string">"OUT_DIR"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"bindings.rs"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"Couldn't write bindings!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>定义 <code>verbs.rs</code> 使用生成的绑定代码，并且实现需要使用的 <code>static inline</code> 函数：</p>
<pre class="language-rust"><code class="language-rust"><span class="token attribute attr-name">#![allow(dead_code)]</span>
<span class="token attribute attr-name">#![allow(deref_nullptr)]</span>
<span class="token attribute attr-name">#![allow(non_snake_case, non_camel_case_types, non_upper_case_globals)]</span>
<span class="token attribute attr-name">#![allow(clippy::missing_safety_doc, clippy::too_many_arguments)]</span>

<span class="token keyword">use</span> <span class="token namespace">libc<span class="token punctuation">::</span></span><span class="token punctuation">{</span>c_int<span class="token punctuation">,</span> pthread_cond_t<span class="token punctuation">,</span> pthread_mutex_t<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token macro property">include!</span><span class="token punctuation">(</span><span class="token macro property">concat!</span><span class="token punctuation">(</span><span class="token macro property">env!</span><span class="token punctuation">(</span><span class="token string">"OUT_DIR"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"/bindings.rs"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[inline(always)]</span>
<span class="token keyword">pub</span> <span class="token keyword">unsafe</span> <span class="token keyword">fn</span> <span class="token function-definition function">ibv_req_notify_cq</span><span class="token punctuation">(</span>cq<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token keyword">mut</span> ibv_cq<span class="token punctuation">,</span> solicited_only<span class="token punctuation">:</span> c_int<span class="token punctuation">)</span> <span class="token punctuation">-></span> c_int <span class="token punctuation">{</span>
    <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">*</span>cq<span class="token punctuation">)</span><span class="token punctuation">.</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>ops<span class="token punctuation">.</span>req_notify_cq<span class="token punctuation">.</span><span class="token function">unwrap_unchecked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>cq<span class="token punctuation">,</span> solicited_only<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[inline(always)]</span>
<span class="token keyword">pub</span> <span class="token keyword">unsafe</span> <span class="token keyword">fn</span> <span class="token function-definition function">ibv_poll_cq</span><span class="token punctuation">(</span>cq<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token keyword">mut</span> ibv_cq<span class="token punctuation">,</span> num_entries<span class="token punctuation">:</span> c_int<span class="token punctuation">,</span> wc<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token keyword">mut</span> ibv_wc<span class="token punctuation">)</span> <span class="token punctuation">-></span> c_int <span class="token punctuation">{</span>
    <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">*</span>cq<span class="token punctuation">)</span><span class="token punctuation">.</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>ops<span class="token punctuation">.</span>poll_cq<span class="token punctuation">.</span><span class="token function">unwrap_unchecked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>cq<span class="token punctuation">,</span> num_entries<span class="token punctuation">,</span> wc<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[inline(always)]</span>
<span class="token keyword">pub</span> <span class="token keyword">unsafe</span> <span class="token keyword">fn</span> <span class="token function-definition function">ibv_post_send</span><span class="token punctuation">(</span>
    qp<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token keyword">mut</span> ibv_qp<span class="token punctuation">,</span>
    wr<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token keyword">mut</span> ibv_send_wr<span class="token punctuation">,</span>
    bad_wr<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token keyword">mut</span> <span class="token operator">*</span><span class="token keyword">mut</span> ibv_send_wr<span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">-></span> c_int <span class="token punctuation">{</span>
    <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">*</span>qp<span class="token punctuation">)</span><span class="token punctuation">.</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>ops<span class="token punctuation">.</span>post_send<span class="token punctuation">.</span><span class="token function">unwrap_unchecked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>qp<span class="token punctuation">,</span> wr<span class="token punctuation">,</span> bad_wr<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[inline(always)]</span>
<span class="token keyword">pub</span> <span class="token keyword">unsafe</span> <span class="token keyword">fn</span> <span class="token function-definition function">ibv_post_recv</span><span class="token punctuation">(</span>
    qp<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token keyword">mut</span> ibv_qp<span class="token punctuation">,</span>
    wr<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token keyword">mut</span> ibv_recv_wr<span class="token punctuation">,</span>
    bad_wr<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token keyword">mut</span> <span class="token operator">*</span><span class="token keyword">mut</span> ibv_recv_wr<span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">-></span> c_int <span class="token punctuation">{</span>
    <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">*</span>qp<span class="token punctuation">)</span><span class="token punctuation">.</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>ops<span class="token punctuation">.</span>post_recv<span class="token punctuation">.</span><span class="token function">unwrap_unchecked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>qp<span class="token punctuation">,</span> wr<span class="token punctuation">,</span> bad_wr<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="2.-对象封装" tabindex="-1"><a href="#2.-%E5%AF%B9%E8%B1%A1%E5%B0%81%E8%A3%85">2. 对象封装</a></h3>
<p><code>libibverbs</code> 提供的接口中，有很多返回的是对象的指针，并且对象需要显式地执行释放，使用对象时需要传入裸指针。指针自然不适合 Rust，这里对这类对象进行封装。定义 <code>wrapper.rs</code>：</p>
<pre class="language-rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">trait</span> <span class="token type-definition class-name">Deleter</span> <span class="token punctuation">{</span>
    <span class="token keyword">unsafe</span> <span class="token keyword">fn</span> <span class="token function-definition function">delete</span><span class="token punctuation">(</span>ptr<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token keyword">mut</span> <span class="token keyword">Self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">i32</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Wrapper</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token lifetime-annotation symbol">'static</span> <span class="token operator">+</span> <span class="token class-name">Deleter</span> <span class="token operator">+</span> <span class="token operator">?</span><span class="token class-name">Sized</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword">mut</span> <span class="token class-name">T</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token lifetime-annotation symbol">'static</span> <span class="token operator">+</span> <span class="token class-name">Deleter</span> <span class="token operator">+</span> <span class="token operator">?</span><span class="token class-name">Sized</span><span class="token operator">></span> <span class="token class-name">Wrapper</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>v<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token keyword">mut</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
        <span class="token keyword">Self</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token attribute attr-name">#[inline(always)]</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">as_mut_ptr</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">*</span><span class="token keyword">mut</span> <span class="token class-name">T</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token lifetime-annotation symbol">'static</span> <span class="token operator">+</span> <span class="token class-name">Deleter</span> <span class="token operator">+</span> <span class="token operator">?</span><span class="token class-name">Sized</span><span class="token operator">></span> <span class="token class-name">Drop</span> <span class="token keyword">for</span> <span class="token class-name">Wrapper</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">drop</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">match</span> <span class="token keyword">unsafe</span> <span class="token punctuation">{</span> <span class="token class-name">Deleter</span><span class="token punctuation">::</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token punctuation">{</span>
            <span class="token number">0</span> <span class="token operator">=></span> <span class="token namespace">tracing<span class="token punctuation">::</span></span><span class="token macro property">debug!</span><span class="token punctuation">(</span><span class="token string">"release {} succ"</span><span class="token punctuation">,</span> <span class="token namespace">std<span class="token punctuation">::</span>any<span class="token punctuation">::</span></span><span class="token function">type_name</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            r <span class="token operator">=></span> <span class="token namespace">tracing<span class="token punctuation">::</span></span><span class="token macro property">error!</span><span class="token punctuation">(</span><span class="token string">"release {} failed: {}"</span><span class="token punctuation">,</span> <span class="token namespace">std<span class="token punctuation">::</span>any<span class="token punctuation">::</span></span><span class="token function">type_name</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token lifetime-annotation symbol">'static</span> <span class="token operator">+</span> <span class="token class-name">Deleter</span> <span class="token operator">+</span> <span class="token operator">?</span><span class="token class-name">Sized</span><span class="token operator">></span> <span class="token namespace">std<span class="token punctuation">::</span>ops<span class="token punctuation">::</span></span><span class="token class-name">Deref</span> <span class="token keyword">for</span> <span class="token class-name">Wrapper</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">type</span> <span class="token type-definition class-name">Target</span> <span class="token operator">=</span> <span class="token class-name">T</span><span class="token punctuation">;</span>

    <span class="token attribute attr-name">#[inline(always)]</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">deref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Target</span> <span class="token punctuation">{</span>
        <span class="token keyword">unsafe</span> <span class="token punctuation">{</span> <span class="token operator">&amp;</span><span class="token operator">*</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">unsafe</span> <span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token lifetime-annotation symbol">'static</span> <span class="token operator">+</span> <span class="token class-name">Deleter</span> <span class="token operator">+</span> <span class="token operator">?</span><span class="token class-name">Sized</span><span class="token operator">></span> <span class="token class-name">Send</span> <span class="token keyword">for</span> <span class="token class-name">Wrapper</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">unsafe</span> <span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token lifetime-annotation symbol">'static</span> <span class="token operator">+</span> <span class="token class-name">Deleter</span> <span class="token operator">+</span> <span class="token operator">?</span><span class="token class-name">Sized</span><span class="token operator">></span> <span class="token class-name">Sync</span> <span class="token keyword">for</span> <span class="token class-name">Wrapper</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre>
<p><code>Wrapper</code> 对不同类型的对象裸指针进行封装，要求对象本身实现自定义的释放接口 <code>Deleter::delete</code>。封装举例：</p>
<pre class="language-rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">type</span> <span class="token type-definition class-name">Device</span> <span class="token operator">=</span> <span class="token namespace">utils<span class="token punctuation">::</span></span><span class="token class-name">Wrapper</span><span class="token operator">&lt;</span>ibv_device<span class="token operator">></span><span class="token punctuation">;</span>

<span class="token keyword">impl</span> <span class="token class-name">Device</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">name</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Cow</span><span class="token operator">&lt;</span><span class="token keyword">str</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token keyword">unsafe</span> <span class="token punctuation">{</span> <span class="token class-name">CStr</span><span class="token punctuation">::</span><span class="token function">from_ptr</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">as_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to_string_lossy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">guid</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">u64</span> <span class="token punctuation">{</span>
        <span class="token keyword">u64</span><span class="token punctuation">::</span><span class="token function">from_be</span><span class="token punctuation">(</span><span class="token keyword">unsafe</span> <span class="token punctuation">{</span> <span class="token function">ibv_get_device_guid</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">as_mut_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token namespace">utils<span class="token punctuation">::</span></span><span class="token class-name">Deleter</span> <span class="token keyword">for</span> ibv_device <span class="token punctuation">{</span>
    <span class="token keyword">unsafe</span> <span class="token keyword">fn</span> <span class="token function-definition function">delete</span><span class="token punctuation">(</span>ptr<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token keyword">mut</span> <span class="token keyword">Self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">i32</span> <span class="token punctuation">{</span>
        <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token string">"invalid deletion to Device {ptr:?}!"</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token namespace">std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span></span><span class="token class-name">Debug</span> <span class="token keyword">for</span> <span class="token class-name">Device</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">fmt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> f<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token namespace">std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span></span><span class="token class-name">Formatter</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'_</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token namespace">std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span></span><span class="token class-name">Result</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> guid <span class="token operator">=</span> <span class="token keyword">crate</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>utils<span class="token punctuation">::</span></span><span class="token function">bytes_to_hex_string</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">guid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to_be_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        f<span class="token punctuation">.</span><span class="token function">debug_struct</span><span class="token punctuation">(</span><span class="token string">"Device"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>name<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">"guid"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>guid<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">"node_type"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>node_type<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">"transport_type"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>transport_type<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">pub</span> <span class="token keyword">type</span> <span class="token type-definition class-name">DeviceList</span> <span class="token operator">=</span> <span class="token namespace">utils<span class="token punctuation">::</span></span><span class="token class-name">Wrapper</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token class-name">Device</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">;</span>

<span class="token keyword">impl</span> <span class="token class-name">DeviceList</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">available</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> <span class="token keyword">mut</span> num_devices<span class="token punctuation">:</span> c_int <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token keyword">unsafe</span> <span class="token punctuation">{</span> <span class="token function">ibv_get_device_list</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> num_devices<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> arr<span class="token punctuation">.</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">Error</span><span class="token punctuation">::</span><span class="token function">with_errno</span><span class="token punctuation">(</span><span class="token class-name">ErrorKind</span><span class="token punctuation">::</span><span class="token class-name">IBGetDeviceListFail</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> num_devices <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">Error</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">ErrorKind</span><span class="token punctuation">::</span><span class="token class-name">IBDeviceNotFound</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>
            <span class="token namespace">std<span class="token punctuation">::</span>ptr<span class="token punctuation">::</span></span><span class="token function">slice_from_raw_parts_mut</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> num_devices <span class="token keyword">as</span> <span class="token keyword">usize</span><span class="token punctuation">)</span> <span class="token keyword">as</span> _<span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token namespace">utils<span class="token punctuation">::</span></span><span class="token class-name">Deleter</span> <span class="token keyword">for</span> <span class="token punctuation">[</span><span class="token class-name">Device</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
    <span class="token keyword">unsafe</span> <span class="token keyword">fn</span> <span class="token function-definition function">delete</span><span class="token punctuation">(</span>ptr<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token keyword">mut</span> <span class="token keyword">Self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">i32</span> <span class="token punctuation">{</span>
        <span class="token function">ibv_free_device_list</span><span class="token punctuation">(</span>ptr <span class="token keyword">as</span> _<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token number">0</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token namespace">std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span></span><span class="token class-name">Debug</span> <span class="token keyword">for</span> <span class="token class-name">DeviceList</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">fmt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> f<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token namespace">std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span></span><span class="token class-name">Formatter</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'_</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token namespace">std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span></span><span class="token class-name">Result</span> <span class="token punctuation">{</span>
        f<span class="token punctuation">.</span><span class="token function">debug_tuple</span><span class="token punctuation">(</span><span class="token string">"DeviceList"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">deref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>这里封装的对象类型有：</p>
<ol>
<li>CompChannel：完成事件通道，当完成队列（CQ）有新的完成事件时，通过对应绑定的 CompChannel 进行通知</li>
<li>CompQueue：完成队列，当提交的工作请求（WR）完成时添加到该队列，并提供该 WR 完成的详细信息（状态、长度等）</li>
<li>Context：设备上下文，主要接口的必要参数</li>
<li>DeviceList：设备列表，获取设备指针后可以创建 Context</li>
<li>MemoryRegion：保护域（PD）相关的内存区域，管理 RDMA 设备允许读写的内存区域</li>
<li>ProtectionDomain：保护域，管理 RDMA 设备允许使用的资源</li>
<li>QueuePair：发送队列（Send Queue）和接收队列（Recv Queue），相当于 TCP 编程中的 Socket</li>
</ol>

      </div>
      <script src="https://giscus.app/client.js"
      data-repo="SF-Zhou/sf-zhou.github.io"
      data-repo-id="MDEwOlJlcG9zaXRvcnk4MDc5ODgwNg=="
      data-category="Announcements"
      data-category-id="DIC_kwDOBNDkVs4CA6GQ"
      data-mapping="title"
      data-reactions-enabled="0"
      data-emit-metadata="0"
      data-input-position="bottom"
      data-theme="preferred_color_scheme"
      data-lang="en"
      crossorigin="anonymous"
      async>
    </script>
      <div class="footer">
        <div class="license">
          Except where otherwise noted, content on this site is licensed under a <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> license.
        </div>
        <div class="copyright">
          Copyright©2017 SF-Zhou, All Rights Reserved. Powered by <a href="https://pages.github.com/">GitHub Pages</a> and <a href="https://github.com/features/actions">GitHub Actions</a>.
        </div>
      </div>
    </div>
    <script src="/dist/main.js"></script>
  </body>
</html>
